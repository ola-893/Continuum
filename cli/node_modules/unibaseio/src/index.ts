import { Transaction, ethers } from "ethers";
import { Unibase, Unibase__factory } from "./typechain";

const CONTRACT_UNIBASE = "0x0EF7A5E67e257F1B6078210D60AfDE4d86c0ac7a";
const BSC_TESTNET_PROVIDER = new ethers.providers.JsonRpcProvider("https://bsc-testnet.bnbchain.org");

export class ContractClient {
    readonly signer: ethers.Signer;
    readonly service: Unibase;
    constructor(signer: ethers.Signer) {
        this.signer = signer;
        this.service = Unibase__factory.connect(CONTRACT_UNIBASE, BSC_TESTNET_PROVIDER);
    }

    async openService(space: { name: string; owner: string; url: string }): Promise<Transaction> {
        const account = await this.signer.getAddress();
        const data = ethers.utils.hexlify(ethers.utils.toUtf8Bytes(JSON.stringify(space)));
        return await this.service.connect(this.signer).mint(account, ethers.constants.MaxUint256, data);
    }
}